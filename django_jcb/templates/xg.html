<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<link type="text/css" href="/site_media/css/jquery-ui-1.8.13.custom.css" rel="stylesheet" />	

		<script type="text/javascript" src="/site_media/js/jquery.js"></script>
		<script type="text/javascript" src="/site_media/js/jquery-ui-1.8.13.custom.min.js"></script>
		<script type="text/javascript">


		function show(i)
		{
			$('#frame'+i).hide();
		}
		
		</script>
	</head>
	<body>

	<div>
		{% if not start %}
		<a href='/records/'>返回查询页</a>
		{% else %}
		<a href='/records/?start={{start}}&end={{end}}&page=1'>返回查询页</a>
		{% endif %}
		<fieldset>
			<legend>放款</legend>
			<div>
			放款账号：<input id='acct_no' />
			客户名称：<input id='cust_name' />
			放款金额：<input id='amt' />
			<br />
			币&nbsp;&nbsp;&nbsp;&nbsp;别：
			<select id="bb" style="width:145px">
                        	<option value=1>人民币</option>
                    		<option value=14>美元</option>
                        	<option value=12>英磅</option>
                        	<option value=13>港币</option>
				<option value=15>瑞士法郎</option>
                        	<option value=27>日元</option>
                        	<option value=29>澳大利亚元</option>
				<option value=28>加拿大元</option>
                        	<option value=38>欧元</option>
                        	<option value=21>瑞典克郎</option>
				<option value=22>丹麦克郎</option>
                        	<option value=23>挪威克郎</option>
                        	<option value=32>新加坡元</option>
                        	<option value=81>澳门元</option>
                   	</select>
			放款日期：<input id='fk_date'/>
			放款期限：<input id='fk_qx'/>
			<br />			
			贷款利率：<input id='dk_rate' style='width:141px'/>%
			贷款收益率：<input id='dk_profit'  style='width:133px'/>
			FTP：&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input id='ftp' style='width:135px'/>%
			<br />
			风险资产：<input id='risk_assets' />
			入账机构：<input id='org' />
			客户经理：<input id='employee' />
			<br />
			上浮幅度：<input id='sffd' />
			<br />
			银票金额：<input id='ypje' />
			银票天数：<input id='ypts' />
			银票风险资产：<input id='ypfxzc' style='width:118px' />
			<br />
			银票手续费收入：<input id='ypsxfsr' />
			</div>
		</fieldset>
	</div>

	{% for i in item_count %}
	<div>
		<fieldset>
			<legend onClick="$('#frame{{i}}').toggle(500);">承诺条件{{i}}</legend>
			<div id="frame{{i}}">
			存款客户名称：<input id='ck_cust_name{{i}}' />
			<br />
			存款账号：&nbsp;&nbsp;&nbsp;&nbsp;<input id='ck_acct_no{{i}}' />
			存款日均：<input id='ck_avg_day{{i}}' />
			币&nbsp;&nbsp;&nbsp;&nbsp;别：
			<select id="bb{{i}}" style="width:145px">
                        	<option value=1>人民币</option>
                    		<option value=14>美元</option>
                        	<option value=12>英磅</option>
                        	<option value=13>港币</option>
				<option value=15>瑞士法郎</option>
                        	<option value=27>日元</option>
                        	<option value=29>澳大利亚元</option>
				<option value=28>加拿大元</option>
                        	<option value=38>欧元</option>
                        	<option value=21>瑞典克郎</option>
				<option value=22>丹麦克郎</option>
                        	<option value=23>挪威克郎</option>
                        	<option value=32>新加坡元</option>
                        	<option value=81>澳门元</option>
                   	</select>
			<br />
			存款期限：&nbsp;&nbsp;&nbsp;&nbsp;<input id='ck_qx{{i}}' onkeydown='ckqx_i(event,{{i}})'/>
			存款利率：<input id='ck_rate{{i}}'  onkeydown='ckr_i(event,{{i}})' style='width:135px'/>%
			&nbsp;&nbsp;FTP：&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input id='ftp{{i}}' style='width:135px'/>%
			<br />
			入账机构：&nbsp;&nbsp;&nbsp;&nbsp;<input id='org{{i}}' />
			存款收益率：<input id='ck_profit{{i}}'  style='width:133px''/>
			<br />
			中间业务收入：<input id='zjywsr{{i}}' />
			<br />
			其他条件：&nbsp;&nbsp;&nbsp;&nbsp;<input id='other_cond{{i}}' style="width:700px"/>
			<br />
			派生率:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input id='psl{{i}}' />
			</div>
			
		</fieldset>
	<div>
	{% endfor %}
	<div class="buttons" align="center" >
		<button onClick='cesuan();'>测算</button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		<button onClick='save();'>保存</button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		<button onClick='printing();'>打印</button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		<button onClick='del();'>删除</button>
	</div>

		
<script type="text/javascript">
var dic1=eval('({{dic1}})'.replace(/&quot;/g,'"'));
var dic2=eval('({{dic2}})'.replace(/&quot;/g,'"'));
var dic3=eval('({{dic3}})'.replace(/&quot;/g,'"'));
$(function(){
				$.get('/records/json/id={{id}}',function(data){
					if(data.inform)
						alert(data.inform);
					else
					{
						$('#cust_name').val(data.cust_name);
						$('#acct_no').val(data.acct_no);
						$('#amt').val(data.amt);
						$('#bb').val(data.bb);
						$('#fk_date').val(data.fk_date);
						$('#fk_qx').val(data.fk_qx);
						$('#dk_rate').val(data.dk_rate);
						$('#dk_profit').val(data.dk_profit);
						$('#ftp').val(data.ftp);
						$('#risk_assets').val(data.risk_assets);
						$('#org').val(data.org);
						$('#employee').val(data.employee);
						$('#sffd').val(data.sffd);
						$('#ypje').val(data.ypje);
						$('#ypts').val(data.ypts);
						$('#ypfxzc').val(data.ypfxzc);
						$('#ypsxfsr').val(data.ypsxfsr);
						for(i=1;i<=20;i++)
						{
							if(!data['ck_cust_name'+i])
								break;
							$('#ck_cust_name'+i).val(data['ck_cust_name'+i]);
							$('#ck_acct_no'+i).val(data['ck_acct_no'+i]);
							$('#ck_avg_day'+i).val(data['ck_avg_day'+i]);
							$('#bb'+i).val(data['bb'+i]);
							$('#ck_qx'+i).val(data['ck_qx'+i]);
							$('#ftp'+i).val(data['ftp'+i]);
							$('#ck_rate'+i).val(data['ck_rate'+i]);
							$('#org'+i).val(data['org'+i]);
							$('#ck_profit'+i).val(data['ck_profit'+i]);
							$('#zjywsr'+i).val(data['zjywsr'+i]);
							$('#other_cond'+i).val(data['other_cond'+i]);
							$('#psl'+i).val(data['psl'+i]);
							$('#frame'+i).show();

						}
						
					}
				},'json');


	$('#fk_qx').bind('keydown',function(e){
		if(e.which==13)
		{	
			//e.preventDefault();
			if($('#bb').val()=='1')
			{
				$('#ftp').val(dic2[$('#fk_qx').val()]);
				$('#dk_rate').focus();
			}
		}
	});
	$('#dk_rate').bind('keydown',function(e){
		if(e.which==13)
		{
			$('#dk_profit').val((parseFloat($(this).val()*945)-parseFloat($('#ftp').val()*1000))/100000);
			$('#dk_profit').focus();
		}
	});
	$('#acct_no').bind('keydown',function(e){
		if(e.which==13)
		{
			$('#cust_name').focus();
		}
	});

	$('#cust_name').bind('keydown',function(e){
		if(e.which==13)
		{
			$('#amt').focus();
		}
	});
	$('#amt').bind('keydown',function(e){
		if(e.which==13)
		{
			$('#bb').focus();
		}
	});
	$('#bb').bind('keydown',function(e){
		if(e.which==13)
		{
			$('#fk_date').focus();
		}
	});
	$('#fk_date').bind('keydown',function(e){
		if(e.which==13)
		{
			$('#fk_qx').focus();
		}
	});
	$('#dk_profit').bind('keydown',function(e){
		if(e.which==13)
		{
			$('#ftp').focus();
		}
	});
	$('#ftp').bind('keydown',function(e){
		if(e.which==13)
		{
			$('#risk_assets').focus();
		}
	});	
	$('#risk_assets').bind('keydown',function(e){
		if(e.which==13)
		{
			$('#org').focus();
		}
	});
	$('#org').bind('keydown',function(e){
		if(e.which==13)
		{
			$('#employee').focus();
		}
	});
	$('#employee').bind('keydown',function(e){
		if(e.which==13)
		{
			$('#sffd').focus();
		}
	});
	$('#sffd').bind('keydown',function(e){
		if(e.which==13)
		{
			$('#ypje').focus();
		}
	});
	$('#ypje').bind('keydown',function(e){
		if(e.which==13)
		{
			if($('#ypje').val()=='')$('#ypje').val('0.00');
			$('#ypts').focus();
		}
	});
	$('#ypts').bind('keydown',function(e){
		if(e.which==13)
		{
			if($('#ypts').val()=='')$('#ypts').val('0');
			$('#ypfxzc').focus();
		}
	});
	$('#ypfxzc').bind('keydown',function(e){
		if(e.which==13)
		{
			if($('#ypfxzc').val()=='')$('#ypfxzc').val('0.00');
			$('#ypsxfsr').focus();
			$('#ypsxfsr').val(parseFloat($('#ypje').val())*5/10000.0*0.945);
		}
	});
	{% for i in item_count %}
		$('#ck_cust_name{{i}}').bind('keydown',function(e){
			if(e.which==13)
			{
				$('#ck_acct_no{{i}}').focus();
			}
		});
		$('#ck_acct_no{{i}}').bind('keydown',function(e){
			if(e.which==13)
			{
				$('#ck_avg_day{{i}}').focus();
			}
		});
		$('#ck_avg_day{{i}}').bind('keydown',function(e){
			if(e.which==13)
			{
				if($('#ck_avg_day{{i}}').val()=='')$('#ck_avg_day{{i}}').val('0.00');
				$('#bb{{i}}').focus();
			}
		});
		$('#bb{{i}}').bind('keydown',function(e){
			if(e.which==13)
			{
				$('#ck_qx{{i}}').focus();
			}
		});
		$('#ftp{{i}}').bind('keydown',function(e){
			if(e.which==13)
			{
				if($('#ftp{{i}}').val()=='')$('#ftp{{i}}').val('0.00');
				$('#org{{i}}').focus();
			}
		});
		$('#org{{i}}').bind('keydown',function(e){
			if(e.which==13)
			{
				$('#ck_profit{{i}}').focus();
			}
		});
		$('#ck_profit{{i}}').bind('keydown',function(e){
			if(e.which==13)
			{
				if($('#ck_profit{{i}}').val()=='')$('#ck_profit{{i}}').val('0.00');
				$('#zjywsr{{i}}').focus();
			}
		});
		$('#zjywsr{{i}}').bind('keydown',function(e){
			if(e.which==13)
			{
				if($('#zjywsr{{i}}').val()=='')$('#zjywsr{{i}}').val('0.00');
				$('#other_cond{{i}}').focus();
			}
		});
		$('#other_cond{{i}}').bind('keydown',function(e){
			if(e.which==13)
			{
				$('#psl{{i}}').focus();
			}
		});
	{% endfor %}


	for(i=1;i<=20;i++)show(i);for(i=1;i<=20;i++)show(i);

	
})
function ckqx_i(e,i){
	if(window.event)n=e.keyCode;
	else n=e.which;
	if(n==13)
	{
		//e.preventDefault();
		if($('#bb'+i).val()=='1')
		{
			if($('#ck_qx'+i).val()=='')$('#ck_qx'+i).val('0');
			$('#ftp'+i).val(dic1[$('#ck_qx'+i).val()]);
			$('#ck_rate'+i).focus();
		}
	}
}
function ckr_i(e,i){
	if(window.event)n=e.keyCode;
	else n=e.which;
	if(n==13)
	{//alert($('#ftp'+i).val());alert($('#ck_rate'+i).val());
		if($('#ck_rate'+i).val()==''){$('#ck_rate'+i).val('0.00');$('#ck_profit'+i).val('0.00');}
		else{
			$('#ck_profit'+i).val((parseFloat($('#ftp'+i).val())-parseFloat($('#ck_rate'+i).val()))/100);
		}
		$('#ftp'+i).focus()
	}
}
function cesuan()
{
	var sum=0.0;
	for(i=1;i<=20;i++)
	{
		if($('#ck_avg_day'+i).val()!='')
			sum=sum+(parseFloat($('#ck_avg_day'+i).val())*360*parseFloat($('#ck_profit'+i).val())*10000+parseFloat($('#zjywsr'+i).val())*10000*360)*parseFloat(dic3[$('#bb'+i).val()]);
		else break;
	}

	sum=(parseFloat($('#amt').val())*parseFloat($('#fk_qx').val())*parseFloat($('#dk_profit').val())*10000-parseFloat($('#risk_assets').val())*parseFloat($('#fk_qx').val())*8*15)*parseFloat(dic3[$('#bb').val()])+sum-parseFloat($('#ypfxzc').val())*8*parseFloat($('#ypts').val())*15+parseFloat($('#ypsxfsr').val())*3600000;
	sum=sum/3600000.0;
	suggest=parseFloat($('#amt').val())*{{rate}}*parseFloat($('#fk_qx').val())*parseFloat(dic3[$('#bb').val()])/36000.0-parseFloat($('#risk_assets').val())*8*15*parseFloat(dic3[$('#bb').val()])*0.8*parseFloat($('#fk_qx').val())/360.0/10000.0;
	alert('综合收益: '+sum+'\n综合收益建议: '+suggest);
		
}

function save()
{
	var object='{"cust_name":"'+$('#cust_name').val()+'","acct_no":"'+$('#acct_no').val()+'",';
	object+='"amt":"'+$('#amt').val()+'","bb":"'+$('#bb').val()+'","fk_date":"'+$('#fk_date').val()+'",';
	object+='"fk_qx":"'+$('#fk_qx').val()+'","dk_rate":"'+$('#dk_rate').val()+'",';
	object+='"dk_profit":"'+$('#dk_profit').val()+'","risk_assets":"'+$('#risk_assets').val()+'",';
	object+='"org":"'+$('#org').val()+'","employee":"'+$("#employee").val()+'",';
	object+='"ftp":"'+$('#ftp').val()+'",';
	object+='"sffd":"'+$('#sffd').val()+'",';
	object+='"ypje":"'+$('#ypje').val()+'",';
	object+='"ypts":"'+$('#ypts').val()+'",';
	object+='"ypfxzc":"'+$('#ypfxzc').val()+'",';
	object+='"ypsxfsr":"'+$('#ypsxfsr').val()+'",';
	for(i=1;i<=20;i++)
	{
		if($('#ck_cust_name'+i).val().replace(/\s/g,'')=='')
		{
			break;
		}
		object+='"ck_cust_name'+i+'":"'+$('#ck_cust_name'+i).val()+'",';
		object+='"ck_acct_no'+i+'":"'+$('#ck_acct_no'+i).val()+'",';
		object+='"ck_avg_day'+i+'":"'+$('#ck_avg_day'+i).val()+'",';
		object+='"bb'+i+'":"'+$('#bb'+i).val()+'",';
		object+='"ck_qx'+i+'":"'+$('#ck_qx'+i).val()+'",';
		object+='"ck_rate'+i+'":"'+$('#ck_rate'+i).val()+'",';
		object+='"org'+i+'":"'+$('#org'+i).val()+'",';
		object+='"ck_profit'+i+'":"'+$('#ck_profit'+i).val()+'",';
		object+='"zjywsr'+i+'":"'+$('#zjywsr'+i).val()+'",';
		object+='"other_cond'+i+'":"'+$('#other_cond'+i).val()+'",';
		object+='"ftp'+i+'":"'+$('#ftp'+i).val()+'",';
		object+='"psl'+i+'":"'+$('#psl'+i).val()+'",';
	}
	object+='}';

	$.ajax({
		type:'PUT',
		url:'/records/json/id={{id}}',
		data:object,
		dataType:'text',
		success:function(data){
			alert('保存成功');
			},
		error:function(){
			alert('无法保存该记录');
		}
	});	
}
function loadData(data)
{
	
}
function printing()
{
	$.get('/records/txt/id={{id}}',function(data){
			window.open(data);
		},'text');
}
function del()
{
	$.ajax({
		type:'DELETE',
		url:'/records/json/id={{id}}',
		success:function(data){
			alert('删除成功');
			window.location.href='/records/?start={{start}}&end={{end}}&page=1';
			},
		error:function(){
			alert('无法删除该记录');
		}
	});	
}
</script>
	</body>
</html>


